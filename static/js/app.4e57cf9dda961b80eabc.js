webpackJsonp([2,0],[function(e,t,a){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=a(76),s=o(n),i=a(74),r=o(i),c=a(75),d=o(c),l=a(73),u=o(l),h=a(70),p=o(h),f=a(69),m=o(f),v=a(71),g=o(v),b=a(10);s["default"].use(r["default"]),s["default"].use(d["default"]),s["default"].use(u["default"]),s["default"].filter("titleCase",function(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}),s["default"].http.options.root=b.API_DOMAIN+b.API_ROOT,s["default"].http.headers.common["X-Authorization"]=b.API_KEY;var y=new r["default"]({hashbang:!1});y.map({"/":{component:p["default"]},"/about":{component:m["default"]},"/search/:originLocation/:destinationLocation/:startDate/:endDate":{name:"search",component:g["default"]}}),y.redirect({"*":"/"});var x=s["default"].extend({});y.start(x,"#app")},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={state:{visible:!1,text:"",type:"",timer:null},showMessage:function(e){var t=arguments.length<=1||void 0===arguments[1]?"info":arguments[1];this.state.text=e,this.state.type=t,this.state.visible=!0,clearTimeout(this.state.timer);var a=this;this.state.timer=setTimeout(function(){a.state.visible=!1},5e3)},hideMessage:function(){this.state.visible=!1,this.state.text=""}};t["default"]=a},,,function(e,t,a){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(60),s=o(n),i=a(1),r=o(i),c={getLocations:function(){return s["default"]},lookupCodeFromLocation:function(e){var t=!1;return s["default"].forEach(function(a){a.name.toLowerCase()===e&&(t=a.code)}),t},isValidLocation:function(e){var t=!1;return c.getLocations().forEach(function(a){a.name.toLowerCase()===e&&(t=!0)}),t||r["default"].showMessage("Invalid location selected","danger"),t}};t["default"]=c},,,,function(e,t,a){var o,n;n=a(64),e.exports=o||{},e.exports.__esModule&&(e.exports=e.exports["default"]),n&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=n)},function(e,t,a){var o,n;a(55),o=a(21),n=a(65),e.exports=o||{},e.exports.__esModule&&(e.exports=e.exports["default"]),n&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=n)},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.API_DOMAIN="https://megabus-scraper-server.digitalbydan.com/",t.API_ROOT="api/v1",t.API_KEY="o0yBWAgXX2xuwyvXqrLbHdzCx2JQj5Pf4wjXpwuYpQYOlr91LAYxpdybuxc6",t.BASE_MEGABUS_URL="http://uk.megabus.com/JourneyResults.aspx?inboundDepartureDate=&passengerCount=1&transportType=-1&concessionCount=0&nusCount=0&outboundWheelchairSeated=0&outboundOtherDisabilityCount=0&inboundWheelchairSeated=0&inboundOtherDisabilityCount=0&outboundPcaCount=0&inboundPcaCount=0&promotionCode=&withReturn=0&accept=perm"},function(e,t,a){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(1),s=o(n),i={getLengthBetweenDates:function(e,t){var a=864e5,o=Math.abs(this.getDateObjectFromString(e).getTime()-this.getDateObjectFromString(t).getTime())/a;return o=Math.round(o)},getDateObjectFromString:function(e){var t=e.split("-"),a=t[0],o=t[1],n=t[2];return new Date(n,o-1,a)},isValidDate:function(e){var t=!1,a=(new Date).getFullYear(),o=e.split("-"),n=o[0],i=o[1],r=o[2];if(n>=1&&n<=31&&i>=1&&i<=12&&r>=a&&r<=a+1){var c=new Date(o[2],o[1]-1,o[0]);c&&(t=!0)}return t||s["default"].showMessage("Dates should formatted as DD-MM-YYYY and be within one year","danger"),t},isEndDateAfterStartDate:function(e,t){return this.getDateObjectFromString(e)<this.getDateObjectFromString(t)||(s["default"].showMessage("Search start date is after the end date","danger"),!1)},isMaxOneMonthInLength:function(e,t){return!(this.getLengthBetweenDates(e,t)>31)||(s["default"].showMessage("You can only search across a maximum of 31 days","danger"),!1)}};t["default"]=i},function(e,t,a){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(11),s=o(n),i=a(4),r=o(i),c={validate:function(e){return!!(s["default"].isValidDate(e.startDate)&&s["default"].isValidDate(e.startDate)&&s["default"].isEndDateAfterStartDate(e.startDate,e.endDate)&&s["default"].isMaxOneMonthInLength(e.startDate,e.endDate)&&r["default"].isValidLocation(e.originLocation)&&r["default"].isValidLocation(e.destinationLocation))}};t["default"]=c},,,,,,,,function(e,t,a){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function n(e,t,a){return this.l10n=(0,i["default"])({},r.init.prototype.l10n,a),r.init.call(this,e,t)}Object.defineProperty(t,"__esModule",{value:!0});var s=a(25),i=o(s),r=a(59);n.prototype=r.init.prototype,t["default"]={partials:{singleInput:a(61),wrapperInput:a(62)},props:{alignment:String,config:{type:Object,"default":function(){return{}}},l10n:{type:Object,"default":function(){return{}}},placeholder:{type:String,"default":"Pick date"},readonly:Boolean,value:String},ready:function(){this.create()},beforeDestroy:function(){this.destroy()},attached:function(){this.create()},detached:function(){this.destroy()},methods:{create:function(){var e=this;this.datepicker||(this.datepicker=new n(this.$el.nextSibling,this.config,this.l10n),this.datepicker.set("onChange",function(t,a){e.$set("value",a)}))},destroy:function(){this.datepicker&&!this["static"]&&(this.datepicker.destroy(),this.datepicker=null)}},computed:{wrap:function(){return!!this.config.wrap},"static":function(){return!!this.config["static"]},name:function(){return this.wrap?"wrapperInput":"singleInput"}}}},function(e,t,a){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(1),s=o(n);t["default"]={data:function(){return{notificationService:s["default"]}}}},function(e,t,a){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(9),s=o(n),i=a(8),r=o(i);t["default"]={data:function(){return{msg:"Home"}},components:{HeaderComponent:s["default"],FooterComponent:r["default"]}}},function(e,t,a){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(72),s=o(n),i=a(9),r=o(i),c=a(8),d=o(c),l=a(12),u=o(l),h=a(4),p=o(h);t["default"]={data:function(){return{locations:p["default"].getLocations(),searchParams:{originLocation:"",destinationLocation:"",startDate:"",endDate:""}}},components:{HeaderComponent:r["default"],FooterComponent:d["default"],Datepicker:s["default"]},methods:{navigateToSearch:function(){u["default"].validate(this.searchParams)&&this.$router.go({name:"search",params:this.searchParams})}}}},function(e,t,a){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(26),s=o(n),i=a(8),r=o(i),c=a(9),d=o(c),l=a(11),u=o(l),h=a(4),p=o(h),f=a(1),m=o(f),v=a(12),g=o(v),b=a(10);t["default"]={data:function(){return{days:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],searchParams:{originLocation:this.$route.params.originLocation,destinationLocation:this.$route.params.destinationLocation,startDate:this.$route.params.startDate,endDate:this.$route.params.endDate},originCode:p["default"].lookupCodeFromLocation(this.$route.params.originLocation),destinationCode:p["default"].lookupCodeFromLocation(this.$route.params.destinationLocation),lengthBetweenDates:u["default"].getLengthBetweenDates(this.$route.params.startDate,this.$route.params.endDate),resultsStructure:[],resultsLong:{},resultsChunked:[],lowestPrice:900,highestPrice:0,firstThirdPriceBound:0,secondThirdPriceBound:0}},ready:function(){g["default"].validate(this.searchParams)||this.$router.go("/home"),this.makeResultsStructureArray(),this.getResults()},components:{HeaderComponent:d["default"],FooterComponent:r["default"]},methods:{makeResultsStructureArray:function(){for(var e=[],t=0;t<=this.lengthBetweenDates;t++)e.push(t);for(var a=this.chunkArrayToWeeks(e),o=0;o<a.length;o++)for(var n=0;n<a[o].length;n++)a[o][n]=n;this.resultsStructure=a},chunkArrayToWeeks:function(e){for(var t=[],a=0;a<e.length;a+=7){var o=e.slice(a,a+7);t.push(o)}return t},chunkObjectToWeeks:function(e){for(var t=[],a=0;a<(0,s["default"])(e).length;a+=7){var o={},n=0;for(var i in e)n>=a&&n<a+7&&(o[i]=e[i]),n++;t.push(o)}return t},callScraperApi:function(e){var t="search/";return t+=this.originCode+"/",t+=this.destinationCode+"/",t+=e,this.$http.get(t)},getResults:function(){for(var e=this,t=function(t){var a=u["default"].getDateObjectFromString(e.searchParams.startDate);a.setDate(a.getDate()+t);var o=a.getDate()+"-"+(a.getMonth()+1)+"-"+a.getFullYear();e.callScraperApi(o).then(function(a){var n={date:o,results:[]};for(var i in a.data.data)n.results.push({journey:a.data.data[i].journey,time:a.data.data[i].time,duration:a.data.data[i].duration,price:parseFloat(a.data.data[i].price)}),e.priceCheck(a.data.data[i].price),e.setPriceBounds();e.resultsLong[t]=n,(0,s["default"])(e.resultsLong).length===e.lengthBetweenDates+1&&(e.resultsChunked=e.chunkObjectToWeeks(e.resultsLong))},function(){m["default"].showMessage("There was an error scraping results","danger"),e.$router.go("/home")})},a=0;a<=this.lengthBetweenDates;a++)t(a)},priceCheck:function(e){e=parseFloat(e),e<this.lowestPrice&&(this.lowestPrice=e),e>this.highestPrice&&(this.highestPrice=e)},setPriceBounds:function(){var e=this.highestPrice-this.lowestPrice,t=e/3;this.firstThirdPriceBound=this.lowestPrice+t,this.secondThirdPriceBound=this.lowestPrice+2*t},goToMegabusWebsiteResult:function(e){var t=b.BASE_MEGABUS_URL+"&originCode="+this.originCode;t+="&destinationCode="+this.destinationCode,t+="&outboundDepartureDate="+this.replaceAll(e,"-","%2f"),window.open(t)},replaceAll:function(e,t,a){return e.split(t).join(a)}}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},,function(e,t){e.exports=[{code:3,name:"Axminster"},{code:4,name:"Banbury"},{code:5,name:"Barnsley"},{code:6,name:"Bath Spa"},{code:7,name:"Bedford"},{code:8,name:"Birmingham"},{code:9,name:"Birmingham International Airport"},{code:128,name:"Blackburn"},{code:250,name:"Bodmin / St. Austell"},{code:10,name:"Bolton"},{code:11,name:"Bournemouth"},{code:12,name:"Bradford"},{code:143,name:"Brighton"},{code:13,name:"Bristol"},{code:225,name:"Bristol (Aztec)"},{code:226,name:"Bristol (Cribbs Causeway)"},{code:227,name:"Bristol (Filton)"},{code:249,name:"Bristol Airport"},{code:14,name:"Bristol UWE"},{code:16,name:"Camborne"},{code:17,name:"Cambridge"},{code:19,name:"Canterbury"},{code:24,name:"Cheltenham"},{code:130,name:"Chester"},{code:25,name:"Chesterfield"},{code:122,name:"Colchester"},{code:27,name:"Coventry"},{code:144,name:"Crawley"},{code:162,name:"Daventry"},{code:30,name:"Derby"},{code:31,name:"Doncaster"},{code:119,name:"East Dereham"},{code:33,name:"East Midlands Parkway"},{code:36,name:"Exeter"},{code:251,name:"Falmouth"},{code:39,name:"Gloucester"},{code:177,name:"Grantham"},{code:42,name:"Havant"},{code:145,name:"High Wycombe"},{code:44,name:"Honiton"},{code:45,name:"Huddersfield"},{code:46,name:"Hull"},{code:123,name:"Ipswich"},{code:178,name:"Kettering"},{code:120,name:"Kings Lynn"},{code:116,name:"Lancaster"},{code:52,name:"Leeds"},{code:53,name:"Leicester"},{code:54,name:"Liverpool"},{code:56,name:"London"},{code:57,name:"Loughborough"},{code:141,name:"Luton"},{code:58,name:"Manchester"},{code:59,name:"Middlesbrough"},{code:60,name:"Milton Keynes"},{code:62,name:"Newbury"},{code:63,name:"Newcastle"},{code:65,name:"Newquay"},{code:150,name:"Newton Abbot"},{code:166,name:"Northampton"},{code:66,name:"Norwich"},{code:67,name:"Norwich, University of East Anglia"},{code:68,name:"Nottingham"},{code:71,name:"Oxford"},{code:72,name:"Paignton"},{code:74,name:"Penzance"},{code:121,name:"Peterborough"},{code:77,name:"Plymouth"},{code:78,name:"Poole"},{code:79,name:"Portsmouth"},{code:80,name:"Preston"},{code:81,name:"Reading"},{code:82,name:"Redruth"},{code:84,name:"Rugby"},{code:86,name:"Salisbury"},{code:88,name:"Scunthorpe"},{code:90,name:"Sheffield"},{code:91,name:"Silverstone"},{code:93,name:"Southampton"},{code:108,name:"Southampton Airport"},{code:165,name:"St Erth"},{code:164,name:"Stockport"},{code:118,name:"Stoke-On-Trent"},{code:96,name:"Sunderland"},{code:98,name:"Swindon"},{code:100,name:"Taunton"},{code:109,name:"Thetford"},{code:101,name:"Torquay"},{code:167,name:"Towcester"},{code:102,name:"Wakefield/Woolley Edge"},{code:103,name:"Warrington"},{code:104,name:"Weymouth"},{code:129,name:"Wigan"},{code:105,name:"Winchester"},{code:136,name:"Worcester"},{code:142,name:"Worthing"},{code:106,name:"Yeovil Junction"},{code:107,name:"York"}]},function(e,t){e.exports="<input class=input type=text :placeholder=placeholder :readonly=readonly v-model=value /> "},function(e,t){e.exports='<p class="control has-addons flatpickr" data-wrap=true data-clickopens=false :class="{ [`has-addons-${alignment}`]: alignment }"> <input class=input type=text :placeholder=placeholder :readonly=readonly v-model=value data-input/> <slot></slot> </p> '},function(e,t){e.exports=" <partial :name=name> <slot></slot> </partial> "},function(e,t){e.exports=' <footer class=footer> <div class=container> <div class="content has-text-centered"> <p><strong>Megabus Search</strong> by <a href=http://digitalbydan.com>Daniel Ireson</a></p> <p>Not associated with megabus.com</p> </div> </div> </footer> '},function(e,t){e.exports=' <section class="hero is-info is-medium"> <div class=hero-head> <header class=nav> <div class=container> <div class=nav-left> <a v-link="\'/\'" class="header-logo nav-item"> <i class="fa fa-search"></i>Megabus Search </a> </div> <div class="nav-right nav-menu"> <span class=nav-item> <a href=https://github.com/danielireson/megabus-scraper-client class="button is-info is-inverted" target=_blank> <span class=icon> <i class="fa fa-github"></i> </span> <span>Client</span> </a> </span> <span class=nav-item> <a href=https://github.com/danielireson/megabus-scraper-server class="button is-info is-inverted" target=_blank> <span class=icon> <i class="fa fa-github"></i> </span> <span>Scraper</span> </a> </span> </div> </div> </header> </div> </section> <div v-show=notificationService.state.visible class="notification is-{{ notificationService.state.type }}"> <button @click=notificationService.hideMessage() class=delete></button> {{ notificationService.state.text }} </div> '},function(e,t){e.exports=' <header-component></header-component> <section class="hero is-info is-medium"> <div class=hero-body> <div class="container has-text-centered"> <h1 class=title> About Megabus Search </h1> </div> </div> </section> <footer-component></footer-component> '},function(e,t){e.exports=' <header-component></header-component> <section class="hero is-info is-medium"> <div class=hero-body> <div class="container has-text-centered"> <h1 class=title> The quickest way to search Megabus UK prices </h1> </div> </div> </section> <div class=columns> <div class="column is-half is-offset-one-quarter"> <section class=section> <div class=container> <div class="columns is-mobile"> <div class="column is-half"> <label class=label>Origin</label> <p class=control> <span class="select is-fullwidth"> <select v-model=searchParams.originLocation> <option value="" disabled=disabled selected=selected>Select location</option> <option v-for="location in locations" :value=location.name.toLowerCase()>{{ location.name }}</option> </select> </span> </p> <label class=label>Start date for search</label> <div id=startDate> <datepicker placeholder="Select date" :config="{ dateFormat: \'d-m-Y\' }" :value.sync=searchParams.startDate> </datepicker> </div> </div> <div class="column is-half"> <label class=label>Destination</label> <p class=control> <span class="select is-fullwidth"> <select v-model=searchParams.destinationLocation> <option value="" disabled=disabled selected=selected>Select location</option> <option v-for="location in locations" :value=location.name.toLowerCase()>{{ location.name }}</option> </select> </span> </p> <label class=label>End date for search</label> <div id=endDate> <datepicker placeholder="Select date" :config="{ dateFormat: \'d-m-Y\' }" :value.sync=searchParams.endDate> </datepicker> </div> </div> </div> <p class=control> <a href @click.prevent=navigateToSearch class="button is-fullwidth is-primary is-outlined"> Search for prices </a> </p> </div> </section> </div> </div> <footer-component></footer-component> '},function(e,t){e.exports=' <header-component></header-component> <section class="hero is-info is-small"> <div class=hero-body> <div class="container has-text-centered"> <h1 class=title> {{ searchParams.originLocation | titleCase }} to {{ searchParams.destinationLocation | titleCase }} </h1> <h2 class=subtitle>{{ searchParams.startDate }} <i class="fa fa-arrow-right" aria-hidden=true></i> {{ searchParams.endDate }}</h2> </div> </div> </section> <section class=search-results> <div class="container has-text-centered is-hidden-mobile is-hidden-tablet-only"> <div class=columns> <div v-for="day in days" class=column> {{ day }} </div> </div> </div> <div class=container> <div v-for="week in resultsStructure" class="columns has-text-centered is-block-tablet is-flex-desktop"> <div v-for="day in week" class=column> <div class=box> <a v-show=!resultsChunked[resultsStructure.indexOf(week)] class="button is-loading box-loading"></a> <h3 class=search-results-date>{{ resultsChunked[resultsStructure.indexOf(week)][day].date }}</h3> <div v-show=resultsChunked[resultsStructure.indexOf(week)][day].results v-for="result in resultsChunked[resultsStructure.indexOf(week)][day].results" class=search-result> <div class="columns is-gapless"> <div class=column> <span class=search-result-time>{{ result.time }}</span> </div> <div class=column> <a @click.prevent=goToMegabusWebsiteResult(resultsChunked[resultsStructure.indexOf(week)][day].date) :class="{\'button\': true, \'is-small\': true, \'search-result-price\': true, \'price-low\': result.price <= firstThirdPriceBound, \'price-medium\': result.price > firstThirdPriceBound && result.price <= secondThirdPriceBound, \'price-high\': result.price > secondThirdPriceBound}">£{{ result.price }}</a> </div> </div> </div> <div v-show="resultsChunked[resultsStructure.indexOf(week)][day].results.length === 0"> No results </div> </div> </div> <div v-if="week.length % 7 !== 0" v-for="i in 7 - week.length % 7" class="column is-hidden-mobile is-hidden-tablet-only"> </div> </div> </div> </section> <footer-component></footer-component> '},function(e,t,a){var o,n;a(54),o=a(22),n=a(66),e.exports=o||{},e.exports.__esModule&&(e.exports=e.exports["default"]),n&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=n)},function(e,t,a){var o,n;a(56),o=a(23),n=a(67),e.exports=o||{},e.exports.__esModule&&(e.exports=e.exports["default"]),n&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=n)},function(e,t,a){var o,n;a(57),o=a(24),n=a(68),e.exports=o||{},e.exports.__esModule&&(e.exports=e.exports["default"]),n&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=n)},function(e,t,a){var o,n;a(58),o=a(20),n=a(63),e.exports=o||{},e.exports.__esModule&&(e.exports=e.exports["default"]),n&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=n)}]);
//# sourceMappingURL=app.4e57cf9dda961b80eabc.js.map