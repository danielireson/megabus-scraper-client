webpackJsonp([1,0],[function(e,t,o){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var s=o(7),n=a(s),r=o(87),i=a(r);o(19),o(20);var c=o(82),d=a(c),l=o(84),u=a(l);n["default"].use(i["default"]);var p=new i["default"]({hashbang:!1});p.map({"/":{component:d["default"]},"/search/:originLocation/:destinationLocation/:startDate/:endDate":{name:"search",component:u["default"]}}),p.redirect({"*":"/"});var f=n["default"].extend({});p.start(f,"#app")},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={state:{visible:!1,text:"",type:"",timer:null},showMessage:function(e){var t=arguments.length<=1||void 0===arguments[1]?"info":arguments[1];this.state.text=e,this.state.type=t,this.state.visible=!0,clearTimeout(this.state.timer);var o=this;this.state.timer=setTimeout(function(){o.state.visible=!1},5e3)},hideMessage:function(){this.state.visible=!1,this.state.text=""}};t["default"]=o},function(e,t,o){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var s=o(64),n=a(s),r=o(1),i=a(r),c={getLocations:function(){return n["default"]},lookupCodeFromLocation:function(e){var t=!1;return n["default"].forEach(function(o){o.name.toLowerCase()===e&&(t=o.code)}),t},isValidLocation:function(e){var t=!1;return c.getLocations().forEach(function(o){o.name.toLowerCase()===e&&(t=!0)}),t||i["default"].showMessage("Invalid location selected","danger"),t}};t["default"]=c},,,,,,function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.API_DOMAIN="https://megabus-scraper-server.digitalbydan.com/",t.API_ROOT="api/v1",t.API_KEY="o0yBWAgXX2xuwyvXqrLbHdzCx2JQj5Pf4wjXpwuYpQYOlr91LAYxpdybuxc6",t.BASE_MEGABUS_URL="http://uk.megabus.com/JourneyResults.aspx?inboundDepartureDate=&passengerCount=1&transportType=-1&concessionCount=0&nusCount=0&outboundWheelchairSeated=0&outboundOtherDisabilityCount=0&inboundWheelchairSeated=0&inboundOtherDisabilityCount=0&outboundPcaCount=0&inboundPcaCount=0&promotionCode=&withReturn=0&accept=perm"},function(e,t,o){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var s=o(1),n=a(s),r={getLengthBetweenDates:function(e,t){var o=864e5,a=Math.abs(this.getDateObjectFromString(e).getTime()-this.getDateObjectFromString(t).getTime())/o;return a=Math.round(a)},getDateObjectFromString:function(e){var t=e.split("-"),o=t[0],a=t[1],s=t[2];return new Date(s,a-1,o)},isValidDate:function(e){var t=!1,o=(new Date).getFullYear(),a=e.split("-"),s=a[0],r=a[1],i=a[2];if(s>=1&&s<=31&&r>=1&&r<=12&&i>=o&&i<=o+1){var c=new Date(a[2],a[1]-1,a[0]);c&&(t=!0)}return t||n["default"].showMessage("Dates should formatted as DD-MM-YYYY and be within one year","danger"),t},isEndDateAfterStartDate:function(e,t){return this.getDateObjectFromString(e)<this.getDateObjectFromString(t)||(n["default"].showMessage("Search start date is after the end date","danger"),!1)},isMaxOneMonthInLength:function(e,t){return!(this.getLengthBetweenDates(e,t)>31)||(n["default"].showMessage("You can only search across a maximum of 31 days","danger"),!1)}};t["default"]=r},function(e,t,o){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var s=o(9),n=a(s),r=o(2),i=a(r),c={validate:function(e){return!!(n["default"].isValidDate(e.startDate)&&n["default"].isValidDate(e.startDate)&&n["default"].isEndDateAfterStartDate(e.startDate,e.endDate)&&n["default"].isMaxOneMonthInLength(e.startDate,e.endDate)&&i["default"].isValidLocation(e.originLocation)&&i["default"].isValidLocation(e.destinationLocation))}};t["default"]=c},,,,,,function(e,t,o){var a,s;s=o(68),e.exports=a||{},e.exports.__esModule&&(e.exports=e.exports["default"]),s&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=s)},function(e,t,o){var a,s;o(59),a=o(22),s=o(69),e.exports=a||{},e.exports.__esModule&&(e.exports=e.exports["default"]),s&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=s)},function(e,t,o){var a,s;a=o(23),s=o(70),e.exports=a||{},e.exports.__esModule&&(e.exports=e.exports["default"]),s&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=s)},function(e,t,o){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var s=o(7),n=a(s);n["default"].filter("titleCase",function(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})})},function(e,t,o){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var s=o(7),n=a(s),r=o(86),i=a(r),c=o(8);n["default"].use(i["default"]),n["default"].http.options.root=c.API_DOMAIN+c.API_ROOT,n["default"].http.headers.common["X-Authorization"]=c.API_KEY},function(e,t,o){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function s(e,t,o){return this.l10n=(0,r["default"])({},i.init.prototype.l10n,o),i.init.call(this,e,t)}Object.defineProperty(t,"__esModule",{value:!0});var n=o(31),r=a(n),i=o(63);s.prototype=i.init.prototype,t["default"]={partials:{singleInput:o(65),wrapperInput:o(66)},props:{alignment:String,config:{type:Object,"default":function(){return{}}},l10n:{type:Object,"default":function(){return{}}},placeholder:{type:String,"default":"Pick date"},readonly:Boolean,value:String},ready:function(){this.create()},beforeDestroy:function(){this.destroy()},attached:function(){this.create()},detached:function(){this.destroy()},methods:{create:function(){var e=this;this.datepicker||(this.datepicker=new s(this.$el.nextSibling,this.config,this.l10n),this.datepicker.set("onChange",function(t,o){e.$set("value",o)}))},destroy:function(){this.datepicker&&!this["static"]&&(this.datepicker.destroy(),this.datepicker=null)}},computed:{wrap:function(){return!!this.config.wrap},"static":function(){return!!this.config["static"]},name:function(){return this.wrap?"wrapperInput":"singleInput"}}}},function(e,t,o){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var s=o(1),n=a(s);t["default"]={data:function(){return{notificationService:n["default"]}}}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={props:["isLarge","type","text","searchParams"],methods:{getHeroClass:function(){return{hero:!0,"is-info":!0,"is-medium":this.isLarge}}}}},function(e,t,o){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var s=o(10),n=a(s),r=o(80),i=a(r),c=o(81),d=a(c);t["default"]={data:function(){return{searchParams:{originLocation:"",destinationLocation:"",startDate:"",endDate:""}}},components:{SelectDate:i["default"],SelectLocation:d["default"]},methods:{_goToSearchResultsPage:function(){n["default"].validate(this.searchParams)&&this.$router.go({name:"search",params:this.searchParams})}}}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={props:["loading","results","prices","goToMegabusResult"]}},function(e,t,o){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var s=o(85),n=a(s);t["default"]={props:["date"],components:{Datepicker:n["default"]}}},function(e,t,o){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var s=o(2),n=a(s);t["default"]={data:function(){return{locations:n["default"].getLocations()}},props:["location"]}},function(e,t,o){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var s=o(17),n=a(s),r=o(16),i=a(r),c=o(18),d=a(c),l=o(78),u=a(l);t["default"]={components:{HeaderComponent:n["default"],FooterComponent:i["default"],Hero:d["default"],ParamsForm:u["default"]}}},function(e,t,o){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var s=o(17),n=a(s),r=o(16),i=a(r),c=o(18),d=a(c),l=o(79),u=a(l);t["default"]={props:["searchParams","loading","results","prices","goToMegabusResult"],components:{HeaderComponent:n["default"],FooterComponent:i["default"],Hero:d["default"],SearchResults:u["default"]}}},function(e,t,o){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var s=o(8),n=o(9),r=a(n),i=o(2),c=a(i),d=o(1),l=a(d),u=o(10),p=a(u),f=o(83),h=a(f);t["default"]={data:function(){return{searchParams:{originLocation:this.$route.params.originLocation,destinationLocation:this.$route.params.destinationLocation,startDate:this.$route.params.startDate,endDate:this.$route.params.endDate},loading:!0,originCode:c["default"].lookupCodeFromLocation(this.$route.params.originLocation),destinationCode:c["default"].lookupCodeFromLocation(this.$route.params.destinationLocation),lengthBetweenDates:r["default"].getLengthBetweenDates(this.$route.params.startDate,this.$route.params.endDate),results:[],prices:{lowestPrice:900,highestPrice:0,firstThirdPriceBound:0,secondThirdPriceBound:0}}},ready:function(){p["default"].validate(this.searchParams)||this.$router.go("/home"),this._makeResultsStructureArray(),this._getResults()},components:{Search:h["default"]},methods:{goToMegabusResult:function(e){var t=s.BASE_MEGABUS_URL+"&originCode="+this.originCode;t+="&destinationCode="+this.destinationCode,t+="&outboundDepartureDate="+e.split("-").join("%2f"),window.open(t)},_makeResultsStructureArray:function(){for(var e=[],t=0;t<=this.lengthBetweenDates;t++)e.push(t);for(var o=this._chunkArrayToWeeks(e),a=0;a<o.length;a++)for(var s=0;s<o[a].length;s++)o[a][s]=s;this.results=o},_chunkArrayToWeeks:function(e){for(var t=[],o=0;o<e.length;o+=7){var a=e.slice(o,o+7);t.push(a)}return t},_callScraperApi:function(e){var t="search/";return t+=this.originCode+"/",t+=this.destinationCode+"/",t+=e,this.$http.get(t)},_getResults:function(){var e=this,t=[];this.loading=!0;for(var o=function(o){var a=r["default"].getDateObjectFromString(e.searchParams.startDate);a.setDate(a.getDate()+o);var s=a.getDate()+"-"+(a.getMonth()+1)+"-"+a.getFullYear();e._callScraperApi(s).then(function(a){var n={date:s,results:[]};for(var r in a.data.data)n.results.push({journey:a.data.data[r].journey,time:a.data.data[r].time,duration:a.data.data[r].duration,price:parseFloat(a.data.data[r].price)}),e._priceCheck(a.data.data[r].price),e._setPriceBounds();t[o]=n,t.length===e.lengthBetweenDates+1&&setTimeout(function(){e.results=e._chunkArrayToWeeks(t),e.loading=!1},0)},function(){l["default"].showMessage("There was an error scraping results","danger"),e.$router.go("/home")})},a=0;a<=this.lengthBetweenDates;a++)o(a)},_priceCheck:function(e){e=parseFloat(e),e<this.prices.lowestPrice&&(this.prices.lowestPrice=e),e>this.prices.highestPrice&&(this.prices.highestPrice=e)},_setPriceBounds:function(){var e=this.prices.highestPrice-this.prices.lowestPrice,t=e/3;this.prices.firstThirdPriceBound=this.prices.lowestPrice+t,this.prices.secondThirdPriceBound=this.prices.lowestPrice+2*t}}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){},function(e,t){},function(e,t){},function(e,t){},,function(e,t){e.exports=[{code:3,name:"Axminster"},{code:4,name:"Banbury"},{code:5,name:"Barnsley"},{code:6,name:"Bath Spa"},{code:7,name:"Bedford"},{code:8,name:"Birmingham"},{code:9,name:"Birmingham International Airport"},{code:128,name:"Blackburn"},{code:250,name:"Bodmin / St. Austell"},{code:10,name:"Bolton"},{code:11,name:"Bournemouth"},{code:12,name:"Bradford"},{code:143,name:"Brighton"},{code:13,name:"Bristol"},{code:225,name:"Bristol (Aztec)"},{code:226,name:"Bristol (Cribbs Causeway)"},{code:227,name:"Bristol (Filton)"},{code:249,name:"Bristol Airport"},{code:14,name:"Bristol UWE"},{code:16,name:"Camborne"},{code:17,name:"Cambridge"},{code:19,name:"Canterbury"},{code:24,name:"Cheltenham"},{code:130,name:"Chester"},{code:25,name:"Chesterfield"},{code:122,name:"Colchester"},{code:27,name:"Coventry"},{code:144,name:"Crawley"},{code:162,name:"Daventry"},{code:30,name:"Derby"},{code:31,name:"Doncaster"},{code:119,name:"East Dereham"},{code:33,name:"East Midlands Parkway"},{code:36,name:"Exeter"},{code:251,name:"Falmouth"},{code:39,name:"Gloucester"},{code:177,name:"Grantham"},{code:42,name:"Havant"},{code:145,name:"High Wycombe"},{code:44,name:"Honiton"},{code:45,name:"Huddersfield"},{code:46,name:"Hull"},{code:123,name:"Ipswich"},{code:178,name:"Kettering"},{code:120,name:"Kings Lynn"},{code:116,name:"Lancaster"},{code:52,name:"Leeds"},{code:53,name:"Leicester"},{code:54,name:"Liverpool"},{code:56,name:"London"},{code:57,name:"Loughborough"},{code:141,name:"Luton"},{code:58,name:"Manchester"},{code:59,name:"Middlesbrough"},{code:60,name:"Milton Keynes"},{code:62,name:"Newbury"},{code:63,name:"Newcastle"},{code:65,name:"Newquay"},{code:150,name:"Newton Abbot"},{code:166,name:"Northampton"},{code:66,name:"Norwich"},{code:67,name:"Norwich, University of East Anglia"},{code:68,name:"Nottingham"},{code:71,name:"Oxford"},{code:72,name:"Paignton"},{code:74,name:"Penzance"},{code:121,name:"Peterborough"},{code:77,name:"Plymouth"},{code:78,name:"Poole"},{code:79,name:"Portsmouth"},{code:80,name:"Preston"},{code:81,name:"Reading"},{code:82,name:"Redruth"},{code:84,name:"Rugby"},{code:86,name:"Salisbury"},{code:88,name:"Scunthorpe"},{code:90,name:"Sheffield"},{code:91,name:"Silverstone"},{code:93,name:"Southampton"},{code:108,name:"Southampton Airport"},{code:165,name:"St Erth"},{code:164,name:"Stockport"},{code:118,name:"Stoke-On-Trent"},{code:96,name:"Sunderland"},{code:98,name:"Swindon"},{code:100,name:"Taunton"},{code:109,name:"Thetford"},{code:101,name:"Torquay"},{code:167,name:"Towcester"},{code:102,name:"Wakefield/Woolley Edge"},{code:103,name:"Warrington"},{code:104,name:"Weymouth"},{code:129,name:"Wigan"},{code:105,name:"Winchester"},{code:136,name:"Worcester"},{code:142,name:"Worthing"},{code:106,name:"Yeovil Junction"},{code:107,name:"York"}]},function(e,t){e.exports="<input class=input type=text :placeholder=placeholder :readonly=readonly v-model=value /> "},function(e,t){e.exports='<p class="control has-addons flatpickr" data-wrap=true data-clickopens=false :class="{ [`has-addons-${alignment}`]: alignment }"> <input class=input type=text :placeholder=placeholder :readonly=readonly v-model=value data-input/> <slot></slot> </p> '},function(e,t){e.exports=" <partial :name=name> <slot></slot> </partial> "},function(e,t){e.exports=' <footer class=footer> <div class=container> <div class="content has-text-centered"> <p><strong>Megabus Search</strong> by <a href=http://digitalbydan.com>Daniel Ireson</a></p> <p>Not associated with megabus.com</p> </div> </div> </footer> '},function(e,t){e.exports=' <section class="hero is-info is-medium"> <div class=hero-head> <header class=nav> <div class=container> <div class=nav-left> <a v-link="\'/\'" class="header-logo nav-item"> <i class="fa fa-search"></i>Megabus Search </a> </div> <div class="nav-right nav-menu"> <span class=nav-item> <a href=https://github.com/danielireson/megabus-scraper-client class="button is-info is-inverted" target=_blank> <span class=icon> <i class="fa fa-github"></i> </span> <span>Web Client</span> </a> </span> <span class=nav-item> <a href=https://github.com/danielireson/megabus-scraper-server class="button is-info is-inverted" target=_blank> <span class=icon> <i class="fa fa-github"></i> </span> <span>Scraper API</span> </a> </span> </div> </div> </header> </div> </section> <div v-show=notificationService.state.visible class="notification is-{{ notificationService.state.type }}"> <button @click=notificationService.hideMessage() class=delete></button> {{ notificationService.state.text }} </div> '},function(e,t){e.exports=' <section :class=getHeroClass()> <div class=hero-body> <div class="container has-text-centered"> <div v-if=searchParams> <h1 class=title> {{ searchParams.originLocation | titleCase }} to {{ searchParams.destinationLocation | titleCase }} </h1> <h2 class=subtitle>{{ searchParams.startDate }} <i class="fa fa-arrow-right" aria-hidden=true></i> {{ searchParams.endDate }}</h2> </div> <div v-else> <h1 class=title> {{ text }} </h1> </div> </div> </div> </section> '},function(e,t){e.exports=' <section class=section> <div class=container> <div class="columns is-mobile"> <div class="column is-half"> <label class=label>Origin</label> <p class=control> <span class="select is-fullwidth"> <select-location :location.sync=searchParams.originLocation></select-location> </span> </p> <label class=label>Start date for search</label> <div id=startDate> <select-date :date.sync=searchParams.startDate></select-date> </div> </div> <div class="column is-half"> <label class=label>Destination</label> <p class=control> <span class="select is-fullwidth"> <select-location :location.sync=searchParams.destinationLocation></select-location> </span> </p> <label class=label>End date for search</label> <div id=endDate> <select-date :date.sync=searchParams.endDate></select-date> </div> </div> </div> <p class=control> <a href @click.prevent=_goToSearchResultsPage class="button is-fullwidth is-primary is-outlined"> Search for prices </a> </p> </div> </section> '},function(e,t){e.exports=' <section class=search-results> <div class=container> <div v-for="(weekIndex, week) in results" class="columns has-text-centered is-block-tablet is-flex-desktop"> <div v-for="(dayIndex, day) in week" class=column> <div class=box> <a v-show=loading class="button is-loading box-loading"></a> <div v-if=!loading> <h3 class=search-results-date>{{ results[weekIndex][dayIndex].date }}</h3> <div v-for="result in results[weekIndex][dayIndex].results" class=search-result> <div class="columns is-gapless"> <div class=column> <span class=search-result-time>{{ result.time }}</span> </div> <div class=column> <a @click.prevent=goToMegabusResult(results[weekIndex][dayIndex].date) :class="{\'button\': true, \'is-small\': true, \'search-result-price\': true, \'price-low\': result.price <= prices.firstThirdPriceBound, \'price-medium\': result.price > prices.firstThirdPriceBound && result.price <= prices.secondThirdPriceBound, \'price-high\': result.price > prices.secondThirdPriceBound}">Â£{{ result.price }}</a> </div> </div> </div> </div> <div v-show="loading === false && results[weekIndex][dayIndex].results.length === 0"> No results </div> </div> </div> <div v-if="week.length % 7 !== 0" v-for="i in 7 - week.length % 7" class="column is-hidden-mobile is-hidden-tablet-only"> </div> </div> </div> </section> '},function(e,t){e.exports=' <datepicker placeholder="Select date" :config="{ dateFormat: \'d-m-Y\' }" :value.sync=date> </datepicker> '},function(e,t){e.exports=' <select v-model=location> <option value="" disabled=disabled selected=selected>Select location</option> <option v-for="location in locations" :value=location.name.toLowerCase()>{{ location.name }}</option> </select> '},function(e,t){e.exports=' <header-component></header-component> <hero text="The quickest way to search Megabus UK prices" is-large=true></hero> <div class=columns> <div class="column is-half is-offset-one-quarter"> <params-form></params-form> </div> </div> <footer-component></footer-component> '},function(e,t){e.exports=" <header-component></header-component> <hero :search-params=searchParams></hero> <search-results :loading=loading :results=results :prices=prices :go-to-megabus-result=goToMegabusResult> </search-results> <footer-component></footer-component> "},function(e,t){e.exports=" <search :search-params=searchParams :loading=loading :results=results :prices=prices :go-to-megabus-result=goToMegabusResult> </search> "},function(e,t,o){var a,s;a=o(24),s=o(71),e.exports=a||{},e.exports.__esModule&&(e.exports=e.exports["default"]),s&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=s)},function(e,t,o){var a,s;o(60),a=o(25),s=o(72),e.exports=a||{},e.exports.__esModule&&(e.exports=e.exports["default"]),s&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=s)},function(e,t,o){var a,s;o(61),a=o(26),s=o(73),e.exports=a||{},e.exports.__esModule&&(e.exports=e.exports["default"]),s&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=s)},function(e,t,o){var a,s;a=o(27),s=o(74),e.exports=a||{},e.exports.__esModule&&(e.exports=e.exports["default"]),s&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=s)},function(e,t,o){var a,s;a=o(28),s=o(75),e.exports=a||{},e.exports.__esModule&&(e.exports=e.exports["default"]),s&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=s)},function(e,t,o){var a,s;a=o(29),s=o(76),e.exports=a||{},e.exports.__esModule&&(e.exports=e.exports["default"]),s&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=s)},function(e,t,o){var a,s;a=o(30),s=o(77),e.exports=a||{},e.exports.__esModule&&(e.exports=e.exports["default"]),s&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=s)},function(e,t,o){var a,s;o(62),a=o(21),s=o(67),e.exports=a||{},e.exports.__esModule&&(e.exports=e.exports["default"]),s&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=s)}]);
//# sourceMappingURL=app.c85e477f3c3b0db36663.js.map